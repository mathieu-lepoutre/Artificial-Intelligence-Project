---
title: "DestinationShip"
author: "Mathieu Lepoutre"
date: "1-12-2020"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(ggplot2)
library(keras)
library(readr)
library(data.table)
library(magrittr)
library(anytime)
library(reticulate)


use_python("C:\\Program Files\\Python37")
```

```{python}
import datetime
import csv
import pandas
from IPython.display import Image
```

## Predicting a ship's destination based on it's beginning's latitude and longitude.



```{python}
unprocessed = pd.read_csv("schipsdataset.csv",sep=';')
```

```{python}
unprocessed.head(10)
```


```{python}
Image(filename='preprocessing.png')
```


```{python}
timedelta = 500000 #130uur
speedDelta = 2     #2 meter per seconde
```



```{python}
f = open("schipsdataset.csv")
```


```{python}
fileData = f.readlines()
List = []
outputList = []
```


```{python}
def getTime(tuple):
    return (tuple[0]*60) + tuple[1]
```



```{python}
data = []
for d in fileData:
    temp = d.replace(";",",")
    data.append(temp.split(","))
  
List.append(data[1])
```




```{python}
def splitList(List):
    if(len(List)<1):
        return 0
    newList = []
    newList.append(List[0])
    route = 1
    for i in range(1,len(List)):
        
        if(len(List[i]) > 7):
            if((not (List[i][7]=="") )and (not(newList[len(newList)-1][7] == "") )):
                if((not (List[i][7]=="NULL") )and (not(newList[len(newList)-1][7] == "NULL") )):
                    if(not (List[i][7].rstrip("\n") is None)):
                        if(not (newList[len(newList)-1][7].rstrip("\n") is None)):
                                speedDiff = int(List[i][7]) - int(newList[len(newList)-1][7])
                                if(speedDiff < speedDelta):
                                    newList.append(List[i])
                                else:
                                    d = []
                                    d.append(newList[0][0])
                                    d.append(route)
                                    route = route + 1
                                    d.append(newList[0][2] + "." +newList[0][3])
                                    d.append(newList[0][4] + "." +newList[0][5])
                                    
                                    d.append(newList[len(newList)-1][2] + "."+newList[len(newList)-1][3])
                                    d.append(newList[len(newList)-1][4] + "."+newList[len(newList)-1][5])
                                                                        
                                    
                                    time1 = datetime.datetime.strptime(newList[0][1], '%Y-%m-%d %H:%M:%S.%f')
                                    time2 = datetime.datetime.strptime(newList[len(newList)-1][1], '%Y-%m-%d %H:%M:%S.%f')
                                    timeDiff = time2 - time1
                                    tup = divmod(timeDiff.total_seconds(), 60)    
                                    d.append(getTime(tup))
                                    print(d)
                                    outputList.append(d)
                                    newList = []
                                    newList.append(List[i])
```



```{python}
for i in range(2,len(data)):
    time1 = datetime.datetime.strptime(List[len(List)-1][1], '%Y-%m-%d %H:%M:%S.%f')
    time2 = datetime.datetime.strptime(data[i][1], '%Y-%m-%d %H:%M:%S.%f')
    timeDiff = time2 - time1
    tup = divmod(timeDiff.total_seconds(), 60)
    if(getTime(tup) < timedelta):
        if(len(data[i])>7):
            List.append(data[i])
    else:
        splitList(List)
        List = []
        List.append(data[i])
```


```{python}
with open('output.csv', mode='w') as output_file:
    output_writer = csv.writer(output_file, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    for data in outputList:        
        output_writer.writerow(data)
```

